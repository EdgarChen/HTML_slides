<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <title>NetworkManager slides</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1274, user-scalable=no">
    <link rel="stylesheet" href="../themes/mozilla/styles/style.css">
    <!--
        To apply styles to the certain slides
        use slide ID to get needed elements
        -->
    <style>
        #Cover h2 {
            color:#FFF;
            text-align:center;
            font-size:40px;
            }
        #FitToWidth h2,
        #FitToHeight h2 {
            color:#fff;
            text-align:center;
            }
    </style>
</head>
<body class="list">
    <header class="caption">
        <h1>NetworkManager Enhancement</h1>
        <p>Edgar Chen &#60;echen@mozilla.com&#62;, 2013/08/06</p>
    </header>

<!-- 
    
    Simply copy the whole block for each slide you want.
    Special slides get extra classes. Each slide needs an ID 
    to allow for bookmarking and target jumping.
    
    Images, videos and SVG objects are automatically centred.

    If you add a "cover" class images are taking over the whole 
    screen resized to height. Add a "w" class to resize to width.

 -->
    <div class="slide" id="Introduce"><div>
        <section>
            <header>
                <h2>NetworkManager</h2>
            </header>
            <ul>
                <li>Routing/DNS setup</li>
                    <ul>
                        <li>Network Type</li>
                        <li>Network Interface</li>
                        <li>Active Network</li>
                    </ul>
                <li>Tethering
                    <ul>
                        <li>Wifi Hotspot</li>
                        <li>Usb</li>
                    </ul>
                </li>
                <li>Communicate with Netd/libnetutils
                    <ul>
                        <li>net_worker</li>
                    </ul>
                </li>
            </ul>
        </section>
    </div></div>

    <div class="slide" id="Why"><div>
        <section>
            <header>
                <h2>Why?</h2>
            </header>
            <ul>
                <li>3G and Wifi switch.</li>
                    <ul>
                        <li>Currently handle in RIL.</li>
                    </ul>
                <li>Shared apn connection.
                    <ul>
                        <li>MMS and default.</li>
                    </ul>
                </li>
                <li>Connection request.
                    <ul>
                        <li>Request connection (MMS/SUPL).</li>
                    </ul>
                </li>
                <li>Tethering
                    <ul>
                        <li>Improve</li>
                    </ul>
                </li>
            </ul>
        </section>
    </div></div>

    <div class="slide cover" id="Architecture"><div>
        <section>
            <header>
            </header>
            <img src="pictures/NetworkManager.png" alt="">
        </section>
    </div></div>

    <div class="slide cover" id="Architecture_Enhancement"><div>
        <section>
            <header>
            </header>
            <img src="pictures/NetworkManager_enhance.png" alt="">
        </section>
    </div></div>

    <div class="slide" id="Enhancement"><div>
        <section>
            <header>
                <h2>Enhancement</h2>
            </header>
            <ul>
                <li>NetworkInterface
                    <ul>
                        <li>Register when the network is available.</li>
                        <li>Unregister when the network is unavailable.</li>
                        <li>Register NetworkInterface by <code>type</code>.</li>
                        <li>connect() / disconnect().</li>
                        <li>Report status to NetworkManager.</li>
                    </ul>
                </li>
                <li>DataConnectionManager
                    <ul>
                        <li>Shared APN connection handler.</li>
                    </ul>
                </li>
                <li>NetworkService
                    <ul>
                        <li>Communicate with Netd / libnetutils</li>
                    </ul>
                </li>
            </ul>
        </section>
    </div></div>

    <div class="slide" id="NetworkInterface"><div>
        <section>
            <header>
                <h2>NetworkInterface</h2>
            </header>
            <pre>
                <code>interface nsINetworkInterface {</code>
                <code>  readonly attribute nsINetworkInfo<mark>info;</mark></code>
                <code>  readonly attribute nsIDOMString[]<mark>hostRoutes</mark>;</code>
                <code>  readonly attribute DOMString httpProxyHost;</code>
                <code>  readonly attribute long httpProxyPort;</code>
                <code>  void<mark>connect();</mark></code>
                <code>  void<mark>disconnect();</mark></code>
                <code>  </code>
                <code>  attribute nsIDOMEventListener <mark>onnetworkinfochanged;</mark></code>
                <code>}</code>
            </pre>
        </section>
    </div></div>

    <div class="slide" id="NetworkInfo"><div>
        <section>
            <header>
                <h2>NetworkInfo</h2>
            </header>
            <pre>
                <code><mark class=comment>/* NetworkInfo */</mark></code>
                <code>partial interface nsINetworkInfo {</code>
                <code>  readonly attribute long type; <mark class="comment">/* WIFI/MOBILE/MMS/SUPL */</mark></code>
                <code> <mark>readonly attribute long serviceId;</mark> <mark class="comment">/* Mulit-SIM */</mark></code>
                <code>  readonly attribute long state;</code>
                <code>  readonly attribute DOMString name; <mark class="comment">/* Interface name */</mark></code>
                <code>  <mark class="delete">readonly attribute boolean dhcp;</mark></code>
                <code>  readonly attribute DOMString ip;</code>
                <code>  readonly attribute DOMString netmask;</code>
                <code>  readonly attribute DOMString broadcast;</code>
                <code>  readonly attribute DOMString gateway;</code>
                <code>  readonly attribute DOMString dns1;</code>
                <code>  readonly attribute DOMString dns2;</code>
                <code>}</code>
            </pre>
        </section>
    </div></div>

    <div class="slide" id="Start_NetworkInterface"><div>
        <section>
            <header>
                <h2>New Interfaces</h2>
            </header>
            <ul>
                <li><code>NetworkInterface</code>, <code>NetworkInfo</code>.</li>
                <li>Use new interfaces, but keep the same logic.</li>
                <li>Each Network implements new interfaces.</li>
                <li>Add logic in NetworkManager.</li>
            </ul>
        </section>
    </div></div>

    <div class="slide" id="NetworkService-libnetutils"><div>
        <section>
            <header>
                <h2>NetworkService (libnetutils)</h2>
            </header>
            <pre>
                <code><mark class=comment>/* NetworkManager */</mark></code>
                <code>addHostRoute: function addHostRoute(network) {</code>
                <code>  let options = {</code>
                <code>    cmd: "addHostRoute",</code>
                <code>    ...</code>
                <code>  }</code>
                <code>  <mark class=important>this.worker.postMessage(options);</mark></code>
                <code>}</code>
            </pre>
            <pre>
                <code><mark class=comment>/* NetworkService */</mark></code>
                <code>partial interface nsINetworkService {</code>
                <code>  <mark>DOMRequest</mark> addHostRoute(DOMString ifname, DOMString host); <mark class=comment>/* ?? */</mark></code>
                <code>}</code>
            </pre>
        </section>
    </div></div>

    <div class="slide" id="NetworkService-netd"><div>
        <section>
            <header>
                <h2>NetworkService (netd)</h2>
            </header>
            <pre>
                <code><mark class=comment>/* NetworkManager */</mark></code>
                <code>getNetworkInterfaceStats: function (connectionType, <mark class=important>callback</mark>) {</code>
                <code>  ...</code>
                <code>}</code>
            </pre>
            <pre>
                <code><mark class=comment>/* NetworkService */</mark></code>
                <code>partial interface nsINetworkService {</code>
                <code>  <mark>DOMRequest</mark> getNetworkInterfaceStats(connectionType); <mark class=comment>/* ?? */</mark></code>
                <code>}</code>
            </pre>
        </section>
    </div></div>

    <div class="slide" id="Start_NetworkService"><div>
        <section>
            <header>
                <h2>NetworkService</h2>
            </header>
            <ul>
                <li>Create NetworkService Interface
                <li>Move <code>net_worker</code> related code to NetworkService.</li>
                    <ul>
                        <li>netd, libnetutils.</li>
                    </ul>
                <li>Move NetworkManager to dom/network.
                    <ul>
                        <li>NetworkManager should be a platform independent module.</li>
                    </ul>
                </li>
            </ul>
        </section>
    </div></div>

    <div class="slide" id="Further"><div>
        <section>
            <header>
                <h2>Further work</h2>
            </header>
            <ul>
                <li>NetworkManager Interface
                    <ul>
                        <li>Request network connection, ex. MMS, SUPL</li>
                        <li>DOM API ??</li>
                    </ul>
                </li>
                <li>Connection policy
                    <ul>
                        <li>Generic logic</li>
                        <li>Read configuration files</li>
                    </ul>
                </li>
                <li>Tethering Control
                    <ul>
                        <li>Tethering APN ??</li>
                    </ul>
                </li>
                <li>DataConnectionManager</li>
            </ul>
        </section>
    </div></div>

    <div class="slide shout" id="Q&A"><div>
        <section>
            <header>
                <h2>Q&A</h2>
            </header>
        </section>
    </div></div>

    <!--
        To hide progress bar from entire presentation
        just remove “progress” element.
        -->
    <div class="progress"><div></div></div>
    <script src="../scripts/script.js"></script>
    <!-- Copyright © 2010–2012 EdgarChen — mozilla.com -->
</body>
</html>